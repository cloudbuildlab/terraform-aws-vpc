name: Generate Terraform Documentation

on:
  push:
    branches:
      - main
  workflow_dispatch:

permissions:
  contents: write

jobs:
  terraform-docs:
    uses: cloudbuildlab/actions-terraform-docs-generator/.github/workflows/terraform-docs.yml@v0
    with:
      post_steps: |
        - name: Configure Git
          run: |
            git config user.name "github-actions[bot]"
            git config user.email "github-actions[bot]@users.noreply.github.com"

        - name: Commit and push changes
          run: |
            git fetch origin
            git pull --rebase origin main
            git add .
            if git diff --staged --quiet; then
              echo "No changes to commit"
            else
              git commit -m "docs: update auto-generated documentation"
              git push
            fi
